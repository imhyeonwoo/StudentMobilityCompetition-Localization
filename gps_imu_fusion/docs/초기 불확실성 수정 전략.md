# 초기 공분산 파라미터 최적화 가이드

초기 공분산 파라미터는 EKF 필터의 시작 직후 안정화 속도에 중요한 영향을 미칩니다. 이 값들을 좀 더 정확하게 설정하기 위해 다음 방법을 사용할 수 있습니다.

## 2. 정적 모드에서 초기 공분산 분석
로봇이 완전히 정지한 상태에서 다음 명령을 실행합니다:

```bash
cd ~/KAI/src/gps_imu_fusion/ekf_tuning_scripts
python3 analyze_initial_covariance.py --static -d 60 -n 5 -o ~/KAI/src/gps_imu_fusion/ekf_tuning_results/initial_cov_static
```

이 명령은:
- 정적(정지) 모드에서 분석 수행
- 각 시도마다 60초 동안 수집
- 총 5회 시도
- 결과를 지정된 디렉토리에 저장

## 3. 동적 모드에서 초기 공분산 분석 (선택사항)
로봇이 이동 중일 때도 분석이 필요하다면:

```bash
cd ~/KAI/src/gps_imu_fusion/ekf_tuning_scripts
python3 analyze_initial_covariance.py -d 90 -n 3 -o ~/KAI/src/gps_imu_fusion/ekf_tuning_results/initial_cov_dynamic
```

이 명령은:
- 동적(이동) 모드에서 분석 수행
- 각 시도마다 90초 동안 수집
- 총 3회 시도
- 결과를 지정된 디렉토리에 저장

## 4. 결과 해석 및 적용
분석이 완료되면 두 가지 중요한 결과물이 생성됩니다:

- 그래프: 각 상태(위치, 속도, 자세, 헤딩)의 평균 수렴 시간을 보여줍니다
- YAML 파일: 권장 초기 공분산 파라미터가 포함된 분석 결과

결과 YAML 파일에서 `recommended_params` 섹션을 확인하세요:

```yaml
recommended_params:
  init_pos_unc: 5.0       # 위치 불확실성 (m)
  init_vel_unc: 0.2       # 속도 불확실성 (m/s)
  init_att_unc: 0.17453   # 자세 불확실성 (rad) - 약 10도
  init_hdg_unc: 1.5708    # 헤딩 불확실성 (rad) - 약 90도
  init_accel_bias_unc: 0.981  # 가속도 바이어스 불확실성 (m/s²)
  init_gyro_bias_unc: 0.01745 # 자이로 바이어스 불확실성 (rad/s)
```

## 5. 최종 파라미터 파일에 적용
일반 튜닝 프로세스로 생성된 최종 파라미터 파일에 이 값들을 추가합니다:

```bash
# 최종 파라미터 파일 열기
nano ~/KAI/src/gps_imu_fusion/ekf_tuning_results/tune_*/ekf_fusion_params_final.yaml

# 권장 초기 공분산 파라미터 값으로 수정
```

## 7. 수렴 시간 해석 가이드
분석 결과를 해석할 때 다음을 참고하세요:

- **빠른 수렴(1-2초)**: 초기 불확실성이 적절하거나 약간 높게 설정됨
- **느린 수렴(3초 이상)**: 초기 불확실성이 너무 낮게 설정됨
- **수렴하지 않음**: 초기 불확실성이 매우 낮거나 다른 문제가 있음

일반적으로 정지 상태에서는 더 작은 불확실성 값이, 이동 중에는 더 큰 불확실성 값이 적합합니다.

이 스크립트를 사용하면 초기 공분산 파라미터를 체계적으로 최적화하여 EKF 필터의 시작 직후 안정화 속도를 향상시킬 수 있습니다. 